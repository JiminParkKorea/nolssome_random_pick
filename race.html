<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>Í≤ΩÎßà Í≤åÏûÑ</title>
<style>
    body {
        font-family: Arial, sans-serif;
        background: #f5f5f5;
        text-align: center;
        margin: 0;
        padding: 0;
    }
    h1 { margin: 20px; }
    #raceTrack {
        position: relative;
        width: 90%;
        margin: auto;
    }
    .lane {
        position: relative;
        height: 40px;
        margin: 5px 0;
        background: white;
        border: 1px solid #ccc;
        border-radius: 20px;
        overflow: hidden;
    }
    .name {
        position: absolute;
        left: 10px;
        top: 8px;
        font-weight: bold;
    }
    .horse {
        position: absolute;
        left: 80px;
        top: 5px;
        font-size: 24px;
        transition: left 0.15s;
    }
    .finishLine {
        position: absolute;
        top: 0;
        bottom: 0;
        width: 4px;
        background: red;
        right: 60px;
    }
    .rank {
        position: absolute;
        right: 5px;
        top: 8px;
        font-weight: bold;
        font-size: 14px;
        color: blue;
    }
    button {
        margin: 15px;
        padding: 10px 20px;
        font-size: 16px;
    }
    canvas {
        position: absolute;
        pointer-events: none;
    }

    /* Î™®Îã¨ Ïä§ÌÉÄÏùº */
    .modal {
        display: none;
        position: fixed;
        top: 0; left: 0; right: 0; bottom: 0;
        background: rgba(0,0,0,0.5);
        justify-content: center;
        align-items: center;
        z-index: 999;
    }
    .modal-content {
        background: white;
        padding: 20px 40px;
        border-radius: 10px;
        text-align: center;
        min-width: 300px;
    }
    .modal-content h2 {
        margin-bottom: 15px;
    }
    .modal-content ul {
        list-style: none;
        padding: 0;
    }
    .modal-content li {
        font-size: 18px;
        margin: 5px 0;
    }
</style>
</head>
<body>

<h1>üêé Í≤ΩÎßà Í≤åÏûÑ</h1>
<div>
    <button onclick="startRace()">ÏãúÏûë</button>
    <button onclick="location.reload()">ÏÉàÎ°úÍ≥†Ïπ®</button>
</div>

<div id="raceTrack"></div>

<!-- Î™®Îã¨ -->
<div id="resultModal" class="modal">
    <div class="modal-content">
        <h2>üèÜ ÏÉÅÏúÑ 5ÏúÑ Í≤∞Í≥º</h2>
        <ul id="top5List"></ul>
        <button onclick="closeModal()">Îã´Í∏∞</button>
    </div>
</div>

<script>
const names = [
    "Ïó∞ÏÑ†","ÏßÄÎØº","ÏùÄÏòÅ","Ïä¨Í∏∞","Ïú§ÏÑ±",
    "Ïû¨ÏòÅ","ÏòàÏä¨","Í¥ÄÌòï","Ïù∏ÏÉÅ","ÏÑ∏Ìúò",
    "Ïú§Ï†ï","ÎÇòÎùº","ÌòÑÏ£º","ÏàòÎØº","ÏÑúÏú®",
    "ÏÑ±Íµ¨","Ï¢ÖÌôî","Ìë∏Î¶Ñ","ÏäπÎ™Ö","ÏùÄÏ†ï",
    "ÏÑ∏ÏòÅ","ÏùÄÏÑ†","ÏàòÏÑ±"
];

const horseIcons = ["üêé","üèá","üèáüèª","üèáüèº","üèáüèΩ","üèáüèæ","üèáüèø"];
let shuffledNames = names.sort(() => Math.random() - 0.5);

const track = document.getElementById("raceTrack");

shuffledNames.forEach((name, idx) => {
    let lane = document.createElement("div");
    lane.className = "lane";
    lane.innerHTML = `
        <span class="name">${name}</span>
        <span class="horse" id="horse${idx}">${horseIcons[idx % horseIcons.length]}</span>
        <div class="finishLine"></div>
        <span class="rank" id="rank${idx}"></span>
    `;
    track.appendChild(lane);
});

let positions = new Array(names.length).fill(80);
let finished = [];
let raceInterval;

function startRace() {
    if (raceInterval) return;
    const finishPos = track.clientWidth - 120;

    raceInterval = setInterval(() => {
        for (let i = 0; i < positions.length; i++) {
            if (finished.includes(i)) continue;

            positions[i] += Math.random() * 40 + 10;

            if (positions[i] >= finishPos) {
                positions[i] = finishPos;
                finished.push(i);
                document.getElementById(`rank${i}`).textContent = finished.length + "Îì±";
                launchConfettiLane(i);
            }

            document.getElementById(`horse${i}`).style.left = positions[i] + "px";
        }

        if (finished.length === positions.length) {
            clearInterval(raceInterval);
            showTop5();
            launchConfettiFull();
        }
    }, 150);
}

function launchConfettiLane(laneIndex) {
    let lane = document.getElementsByClassName("lane")[laneIndex];
    let canvas = document.createElement("canvas");
    canvas.width = lane.clientWidth;
    canvas.height = lane.clientHeight;
    lane.appendChild(canvas);

    let ctx = canvas.getContext("2d");
    let particles = [];
    for (let i = 0; i < 20; i++) {
        particles.push({
            x: lane.clientWidth - 70,
            y: lane.clientHeight / 2,
            r: Math.random() * 4 + 2,
            dx: Math.random() * 4 - 2,
            dy: Math.random() * -3 - 1,
            color: `hsl(${Math.random()*360}, 100%, 50%)`
        });
    }

    let confettiInterval = setInterval(() => {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        particles.forEach(p => {
            p.x += p.dx;
            p.y += p.dy;
            p.dy += 0.1;
            ctx.beginPath();
            ctx.arc(p.x, p.y, p.r, 0, Math.PI*2);
            ctx.fillStyle = p.color;
            ctx.fill();
        });
    }, 30);

    setTimeout(() => {
        clearInterval(confettiInterval);
        canvas.remove();
    }, 1000);
}

function launchConfettiFull() {
    let canvas = document.createElement("canvas");
    canvas.style.position = "fixed";
    canvas.style.top = 0;
    canvas.style.left = 0;
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
    canvas.style.zIndex = 1000;
    document.body.appendChild(canvas);

    let ctx = canvas.getContext("2d");
    let particles = [];
    for (let i = 0; i < 150; i++) {
        particles.push({
            x: canvas.width / 2,
            y: canvas.height / 2,
            r: Math.random() * 4 + 2,
            dx: Math.random() * 8 - 4,
            dy: Math.random() * 8 - 4,
            color: `hsl(${Math.random()*360}, 100%, 50%)`
        });
    }

    let confettiInterval = setInterval(() => {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        particles.forEach(p => {
            p.x += p.dx;
            p.y += p.dy;
            p.dy += 0.05;
            ctx.beginPath();
            ctx.arc(p.x, p.y, p.r, 0, Math.PI*2);
            ctx.fillStyle = p.color;
            ctx.fill();
        });
    }, 30);

    setTimeout(() => {
        clearInterval(confettiInterval);
        canvas.remove();
    }, 2000);
}

function showTop5() {
    let top5 = finished.slice(0, 5).map((idx, rank) => ({
        name: shuffledNames[idx],
        rank: rank + 1
    }));

    let list = document.getElementById("top5List");
    list.innerHTML = top5.map(p => `<li>${p.rank}Îì± - ${p.name}</li>`).join("");

    document.getElementById("resultModal").style.display = "flex";
}

function closeModal() {
    document.getElementById("resultModal").style.display = "none";
}
</script>

</body>
</html>
